<?xml version="1.0" ?>
<launch>

  <!-- We need three move groups:
    1. In global namespace for the detection
    2. For planning on robot1
    3. For planning on robot2
  -->

  <!-- sensor configuration for Moveit -->
  <rosparam ns="move_group" command="load" file="$(find chair_manipulation_gazebo)/cfg/sensors.yaml" />
  <include file="$(find dual_arm_manipulator_moveit_config)/launch/dual_arm_manipulator_moveit_planning_execution.launch">
      <arg name="use_rviz" value="false" />
  </include>

  <!-- launch move group for first robot -->
  <group ns="robot1">
    <!-- remapping -->
    <remap from="/robot1/robot1_arm_trajectory_controller"                              to="/robot1_arm_trajectory_controller" />
    <remap from="/robot1/robot1_left_finger_action_controller"                          to="/robot1_left_finger_action_controller" />
    <remap from="/robot1/robot1_right_finger_action_controller"                         to="/robot1_right_finger_action_controller" />
    <remap from="/robot1/robot2_arm_trajectory_controller"                              to="/robot2_arm_trajectory_controller" />
    <remap from="/robot1/robot2_left_finger_action_controller"                          to="/robot2_left_finger_action_controller" />
    <remap from="/robot1/robot2_right_finger_action_controller"                         to="/robot2_right_finger_action_controller" />

    <remap from="/robot1/robot1_arm_trajectory_controller/follow_joint_trajectory"      to="/robot1_arm_trajectory_controller/follow_joint_trajectory" />
    <remap from="/robot1/robot1_arm_trajectory_controller/state"                        to="/robot1_arm_trajectory_controller/state" />
    <remap from="/robot1/robot1_arm_trajectory_controller/command"                      to="/robot1_arm_trajectory_controller/command" />

    <remap from="/robot1/robot1_left_finger_action_controller/gripper_cmd"              to="/robot1_left_finger_action_controller/gripper_cmd" />
    <remap from="/robot1/robot1_right_finger_action_controller/gripper_cmd"             to="/robot1_right_finger_action_controller/gripper_cmd" />

    <remap from="/robot1/robot2_arm_trajectory_controller/follow_joint_trajectory"      to="/robot2_arm_trajectory_controller/follow_joint_trajectory" />
    <remap from="/robot1/robot2_arm_trajectory_controller/state"                        to="/robot2_arm_trajectory_controller/state" />
    <remap from="/robot1/robot2_arm_trajectory_controller/command"                      to="/robot2_arm_trajectory_controller/command" />

    <remap from="/robot1/robot2_left_finger_action_controller/gripper_cmd"              to="/robot2_left_finger_action_controller/gripper_cmd" />
    <remap from="/robot1/robot2_right_finger_action_controller/gripper_cmd"             to="/robot2_right_finger_action_controller/gripper_cmd" />

    <remap from="/robot1/robot_description" to="/robot_description" />
    <remap from="/robot1/robot_description_semantic" to="/robot_description_semantic" />
    <remap from="/robot1/joint_states" to="/joint_states" />

    <!-- sensor configuration for Moveit -->
    <rosparam ns="move_group" command="load" file="$(find chair_manipulation_gazebo)/cfg/sensors.yaml" />

    <!-- launch moveit -->
    <include file="$(find dual_arm_manipulator_moveit_config)/launch/dual_arm_manipulator_moveit_planning_execution.launch">
      <arg name="use_rviz" value="false" />
    </include>
  </group>

  <!-- launch move group for second robot -->
  <group ns="robot2">
    <!-- remapping -->
    <remap from="/robot2/robot1_arm_trajectory_controller"                              to="/robot1_arm_trajectory_controller" />
    <remap from="/robot2/robot1_left_finger_action_controller"                          to="/robot1_left_finger_action_controller" />
    <remap from="/robot2/robot1_right_finger_action_controller"                         to="/robot1_right_finger_action_controller" />
    <remap from="/robot2/robot2_arm_trajectory_controller"                              to="/robot2_arm_trajectory_controller" />
    <remap from="/robot2/robot2_left_finger_action_controller"                          to="/robot2_left_finger_action_controller" />
    <remap from="/robot2/robot2_right_finger_action_controller"                         to="/robot2_right_finger_action_controller" />

    <remap from="/robot2/robot1_arm_trajectory_controller/follow_joint_trajectory"      to="/robot1_arm_trajectory_controller/follow_joint_trajectory" />
    <remap from="/robot2/robot1_arm_trajectory_controller/state"                        to="/robot1_arm_trajectory_controller/state" />
    <remap from="/robot2/robot1_arm_trajectory_controller/command"                      to="/robot1_arm_trajectory_controller/command" />

    <remap from="/robot2/robot1_left_finger_action_controller/gripper_cmd"              to="/robot1_left_finger_action_controller/gripper_cmd" />
    <remap from="/robot2/robot1_right_finger_action_controller/gripper_cmd"             to="/robot1_right_finger_action_controller/gripper_cmd" />

    <remap from="/robot2/robot2_arm_trajectory_controller/follow_joint_trajectory"      to="/robot2_arm_trajectory_controller/follow_joint_trajectory" />
    <remap from="/robot2/robot2_arm_trajectory_controller/state"                        to="/robot2_arm_trajectory_controller/state" />
    <remap from="/robot2/robot2_arm_trajectory_controller/command"                      to="/robot2_arm_trajectory_controller/command" />

    <remap from="/robot2/robot2_left_finger_action_controller/gripper_cmd"              to="/robot2_left_finger_action_controller/gripper_cmd" />
    <remap from="/robot2/robot2_right_finger_action_controller/gripper_cmd"             to="/robot2_right_finger_action_controller/gripper_cmd" />

    <remap from="/robot2/robot_description" to="/robot_description" />
    <remap from="/robot2/robot_description_semantic" to="/robot_description_semantic" />
    <remap from="/robot2/joint_states" to="/joint_states" />

    <!-- sensor configuration for Moveit -->
    <rosparam ns="move_group" command="load" file="$(find chair_manipulation_gazebo)/cfg/sensors.yaml" />

    <!-- launch moveit -->
    <include file="$(find dual_arm_manipulator_moveit_config)/launch/dual_arm_manipulator_moveit_planning_execution.launch">
      <arg name="use_rviz" value="false" />
    </include>
  </group>

  <!-- rviz -->
  <node name="$(anon rviz)" pkg="rviz" type="rviz" args="-d $(find chair_manipulation_gazebo)/cfg/scene.rviz" respawn="false" output="screen" />

</launch>